<!DOCTYPE html>

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>untitled</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Jeremy Kahn">
	
	<link rel="stylesheet" type="text/css" href="css/protoStyle.css" /> 
	
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/keyhandler/keyhandler.js"></script>
	<script type="text/javascript" src="js/keyhandler/keyMaps.js"></script>
	<script type="text/javascript" src="js/draw/update.js"></script>
	<script type="text/javascript" src="js/draw/drawable.js"></script>
	<script type="text/javascript" src="js/draw/gameShapes.js"></script>
	<script type="text/javascript" src="js/draw/viewport.js"></script>
	<script type="text/javascript" src="js/draw/background.js"></script>
	<script type="text/javascript" src="js/draw/primitives.js"></script>
	<script type="text/javascript" src="js/draw/entity.js"></script>
	<script type="text/javascript" src="js/utils.js"></script>
	
	<script type="text/javascript">
		
		var game;
	
		$(function(){
				
				game = {
					framerate : 1000 / 20,
					canvas : $('#backdrop').get(0),
					keymap : {}
				};
				
				game.context = game.canvas.getContext('2d');
				
				game.viewport = new viewport(game);
				game.background = new background(game);
				initShapes(game);
				
				// Testing player shapes
				game.player1 = new entity(game, {
					gameShape : game.shapes.player1,
					height : 60,
					width : 40,
					color : '#0f0',
					state : {
						x : 50,
						y : 50
					},
					onBeforeMove : function(){
						
						var maxX = (this.state.x + this.params.width),
							minX = (this.state.x),
							maxY = (this.state.y + this.params.height),
							minY = (this.state.y),
							difference;
						
						if ( maxX > game.viewport.width ){
							difference = maxX - game.viewport.width;
							game.viewport.pan(-difference, 0)
							this.state.x -= difference;
						}
						
						if ( minX < 0 ){
							difference = 0 - minX;
							game.viewport.pan(difference, 0)
							this.state.x += difference;
						}
						
						if ( maxY > game.viewport.height ){
							difference = maxY - game.viewport.height;
							game.viewport.pan(0, -difference)
							this.state.y -= difference;
						}
						
						if ( minY < 0 ){
							difference = 0 - minY;
							game.viewport.pan(0, difference)
							this.state.y += difference;
						}
					}
				});/**/
				
				setTimeout(function(){
					
					update(game);
					
					setTimeout(arguments.callee,game.framerate);					
				},game.framerate);
				
				handleKeys(game.keymap);
		});
	</script>
	
	<!-- Date: 2010-10-02 -->
</head>
<body>
	<canvas id="backdrop"></canvas>
</body>
</html>
